(()=>{"use strict";function e(t){return e="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},e(t)}function t(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function r(r){for(var n=1;n<arguments.length;n++){var a=null!=arguments[n]?arguments[n]:{};n%2?t(Object(a),!0).forEach((function(t){var n,o,i;n=r,o=t,i=a[t],(o=function(t){var r=function(t,r){if("object"!==e(t)||null===t)return t;var n=t[Symbol.toPrimitive];if(void 0!==n){var a=n.call(t,"string");if("object"!==e(a))return a;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"===e(r)?r:String(r)}(o))in n?Object.defineProperty(n,o,{value:i,enumerable:!0,configurable:!0,writable:!0}):n[o]=i})):Object.getOwnPropertyDescriptors?Object.defineProperties(r,Object.getOwnPropertyDescriptors(a)):t(Object(a)).forEach((function(e){Object.defineProperty(r,e,Object.getOwnPropertyDescriptor(a,e))}))}return r}function n(e,t,n){var a=JSON.parse(localStorage.getItem(n))||[],o=a.findIndex((function(t){return t.id===e.id}));if(-1!==o)a[o][t]=e[t];else{var i=e.mealTime||"goal"===t?e:r(r({},e),{},{mealTime:"Завтрак"});a.push(i)}return localStorage.setItem(n,JSON.stringify(a)),a}function a(e){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},a(e)}function o(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function i(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function l(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?i(Object(r),!0).forEach((function(t){u(e,t,r[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):i(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}function u(e,t,r){return(t=s(t))in e?Object.defineProperty(e,t,{value:r,enumerable:!0,configurable:!0,writable:!0}):e[t]=r,e}function c(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,s(n.key),n)}}function s(e){var t=function(e,t){if("object"!==a(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==a(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===a(t)?t:String(t)}var f=function(){function e(t,r,n){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._tableBody=document.querySelector(".table__body"),this._addBtn=document.querySelector(".page__btn-add"),this._deleteAllBtn=document.querySelector(".page__delete-btn"),this._sortedField,this._savedElements,this._filteredElements=[],this._headers=document.querySelectorAll(".table__header"),this._mealData,this._getCurrentDate=t,this._updateSummary=r,this._renderCharts=n,this._searchInput=document.querySelector(".page__search-input")}var t,r;return t=e,(r=[{key:"getCurrentElements",value:function(){return this._filteredElements}},{key:"_generateItem",value:function(e){var t=this,r=document.querySelector("#table-row").content.cloneNode(!0),n=r.querySelectorAll(".table__input");this._rowTemplate=r.querySelector(".table__row");var a,o=r.querySelector(".table__delete-btn"),i=r.querySelector(".table__row"),l=r.querySelector(".table__input-meal");return e?(this._fillTable(e,i),a=e.id):a=Date.now().toString(36)+Math.random().toString(36).substring(2),i.setAttribute("data-id",a),n.forEach((function(e){e.addEventListener("blur",(function(){t._handleInputChange(a,e,i)}))})),o.addEventListener("click",(function(){return t._deleteItem(a,i)})),{elementTemplate:r,mealInput:l}}},{key:"_fillTable",value:function(e,t){var r=t.querySelector(".table__input-meal"),n=t.querySelector(".table__meal-type"),a=t.querySelector(".table__meal-size"),o=t.querySelector(".table__meal-energy");r.value=e.meal||"Что-то вкусное",n.value=e.mealTime||"Завтрак",a.value=e.mealSize||"",o.value=e.mealEnergy||""}},{key:"renderItems",value:function(e){var t=this;if(this._tableBody.querySelectorAll(".table__row").forEach((function(e){e.remove()})),this._savedElements=e||JSON.parse(localStorage.getItem("meals")),this._savedElements){var r=this._getCurrentDate(),n=this._savedElements.filter((function(e){return e.date===r}));e||(this._filteredElements=n),n.forEach((function(e){var r=t._generateItem(e).elementTemplate;t._tableBody.append(r),t._rowTemplate.classList.remove("table__row_template")}))}}},{key:"_handleInputChange",value:function(e,t,r){var a=t.value;if(a){var o,i="number"===t.type?Number(a):a,c=(u(o={id:e},t.name,i),u(o,"date",this._getCurrentDate()),o),s=t.name;n(c,s,"meals");var f=this._filteredElements.findIndex((function(e){return e.id===c.id}));if(-1!==f)this._filteredElements[f][s]=c[s];else{var m=c.mealTime?c:l(l({},c),{},{mealTime:"Завтрак"});this._filteredElements.push(m)}r.classList.remove("table__row_template")}this._updateSummary(),this._renderCharts()}},{key:"_deleteItem",value:function(e,t){!function(e,t){var r=(JSON.parse(localStorage.getItem(t))||[]).filter((function(t){return t.id!==e}));localStorage.setItem(t,JSON.stringify(r))}(e,"meals");var r=this._filteredElements.filter((function(t){return t.id!==e}));this._filteredElements=r,t.remove(),this._updateSummary(),this._renderCharts()}},{key:"_sortTable",value:function(e){var t=this,r=this._sortedField;r=r&&r[e]&&"asc"===r[e]?u({},e,"desc"):u({},e,"asc");var n,a=(n=this._filteredElements,function(e){if(Array.isArray(e))return o(e)}(n)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(n)||function(e,t){if(e){if("string"==typeof e)return o(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?o(e,t):void 0}}(n)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()).sort(function(e,t){return function(r,n){var a=r[e],o=n[e];return a<o?"asc"===t?-1:1:a>o?"asc"===t?1:-1:0}}(e,r[e])),i=document.querySelectorAll(".table__row");a.forEach((function(e,r){i[r]&&t._fillTable(e,i[r])})),this._sortedField=r}},{key:"_handleSearch",value:function(e){var t=e.target.value.toLowerCase(),r=this._filteredElements.filter((function(e){return e.meal.toLowerCase().includes(t)}));this.renderItems(r)}},{key:"dropSearch",value:function(){this._searchInput.value=""}},{key:"setEventListeners",value:function(){var e=this;this._addBtn.addEventListener("click",(function(){var t=e._generateItem(),r=t.elementTemplate,n=t.mealInput;e._tableBody.append(r),n.focus()})),this.renderItems(),this._deleteAllBtn.addEventListener("click",(function(){e._tableBody.querySelectorAll(".table__row").forEach((function(t){e._deleteItem(t.dataset.id,t)}))})),this._headers.forEach((function(t){t.addEventListener("click",(function(){e._sortTable(t.dataset.name),e._headers.forEach((function(e){return e.classList.remove("table__header_asc","table__header_desc")})),t.classList.add("table__header_".concat(e._sortedField[t.dataset.name]))}))})),this._searchInput.addEventListener("input",(function(t){return e._handleSearch(t)}))}}])&&c(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function m(e){return m="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},m(e)}function d(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==m(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==m(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===m(a)?a:String(a)),n)}var a}var y=function(){function e(t,r){var n=t.getCurrentElements,a=t.getCurrentDate;!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._goalElement=document.querySelector(".page__goal-value"),this._factElement=document.querySelector(".page__fact-value"),this._percentElement=document.querySelector(".page__fact-value-percent"),this._getCurrentElements=n,this._getCurrentDate=a,this._editBtn=document.querySelector(".page__goal-edit-btn"),this._goals=JSON.parse(localStorage.getItem("goals"))||[],this._goalBox=document.querySelector(".page__goal-box"),this._factBox=document.querySelector(".page__fact-box"),this._limitValue=document.querySelector(".page__tooltip-value"),this._renderCharts=r}var t,r;return t=e,(r=[{key:"_updateGoal",value:function(){var e=this._getCurrentDate(),t={id:e,date:e,goal:Number(this._goalElement.value)};n(t,"goal","goals");var r=this._goals.findIndex((function(e){return e.id===t.id}));-1!==r?this._goals[r].goal=t.goal:this._goals.push(t),0!==this._goalElement.value?this._goalBox.classList.remove("page__goal-box_inactive"):this._goalBox.classList.add("page__goal-box_inactive")}},{key:"fillSummary",value:function(){var e,t=this._getCurrentDate(),r=this._getCurrentElements(),n=this._goals.find((function(e){return e.date===t})),a=0;if(r.length>0&&(a=r.map((function(e){return e.mealEnergy?e.mealEnergy:0})).reduce((function(e,t){return e+t}))),this._factElement.textContent=a,n&&0!==n.goal)this._goalElement.value=n.goal,e=n.goal,this._goalBox.classList.remove("page__goal-box_inactive"),this._percentElement.textContent=Math.round(a/n.goal*100)+"%";else if(this._goals.length>0&&0!==(null==n?void 0:n.goal)){var o=this._goals.map((function(e){return e.goal})),i=Math.round(o.reduce((function(e,t){return e+t}))/o.length);this._goalElement.value=i,this._percentElement.textContent=Math.round(a/i*100)+"%",e=i}else this._goalBox.classList.add("page__goal-box_inactive"),this._percentElement.textContent="0%";this._checkLimit(a,e)}},{key:"_checkLimit",value:function(e,t){e>t?(this._factBox.classList.add("page__fact-box_exceeded"),this._limitValue.textContent=Math.round(e-t)):this._factBox.classList.remove("page__fact-box_exceeded")}},{key:"setEventListeners",value:function(){var e=this;this.fillSummary(),this._editBtn.addEventListener("click",(function(){e._goalElement.focus(),e._goalBox.classList.remove("page__goal-box_inactive")})),this._goalElement.addEventListener("blur",(function(){e._updateGoal(),e.fillSummary(),e._renderCharts()}))}}])&&d(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function _(e){return _="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},_(e)}function v(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function h(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,(void 0,a=function(e,t){if("object"!==_(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==_(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(n.key),"symbol"===_(a)?a:String(a)),n)}var a}var p=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this._selector=document.querySelector(t),this._canvas=this._selector.querySelector(".page__canvas"),this._ctx=this._canvas.getContext("2d")}var t,r;return t=e,(r=[{key:"renderChart",value:function(e){var t,r=this,n=Math.max.apply(Math,function(e){if(Array.isArray(e))return v(e)}(t=e.map((function(e){return e.value})))||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(t)||function(e,t){if(e){if("string"==typeof e)return v(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?v(e,t):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),a=window.innerWidth,o=a<500?30:40,i=a<500?12:20;this._canvas.width=e.length*(o+i),this._canvas.height=a<500?150:230,this.canvasWidth=this._canvas.width,this.canvasHeight=this._canvas.height,this.x=10,e.forEach((function(e){var t=e.value/n*(.8*r.canvasHeight-10);r._ctx.fillStyle="#769e95",r._ctx.fillRect(r.x,r.canvasHeight-t-17,o,t);var a=r.x+o/2-10,l=r.canvasHeight-17+17;r._ctx.fillStyle="#747474",r._ctx.font="11px 'Noto Sans Display'",r._ctx.fillText(e.date,a,l-2),r._ctx.fillStyle="#5e7f78";var u=r._ctx.measureText(e.value).width;r._ctx.fillText(e.value,r.x+o/2-u/2,r.canvasHeight-t-20),r.x+=o+i}))}}])&&h(t.prototype,r),Object.defineProperty(t,"prototype",{writable:!1}),e}();function g(e){var t=new Date(e),r=(t.getMonth()+1).toString().padStart(2,"0"),n=t.getDate().toString().padStart(2,"0");return"".concat(n,".").concat(r)}function b(e,t){var r=new Date(e),n=new Date(t);return r.toDateString()===n.toDateString()}function S(e){return S="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},S(e)}function w(e,t){var r=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),r.push.apply(r,n)}return r}function E(e){for(var t=1;t<arguments.length;t++){var r=null!=arguments[t]?arguments[t]:{};t%2?w(Object(r),!0).forEach((function(t){var n,a,o;n=e,a=t,o=r[t],(a=function(e){var t=function(e,t){if("object"!==S(e)||null===e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,"string");if("object"!==S(n))return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e);return"symbol"===S(t)?t:String(t)}(a))in n?Object.defineProperty(n,a,{value:o,enumerable:!0,configurable:!0,writable:!0}):n[a]=o})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(r)):w(Object(r)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(r,t))}))}return e}var O,j,x,D,C=document.querySelector(".page__datepicker-input"),P=document.querySelector(".page__date-value"),k=document.querySelector(".navigation__link"),L=document.querySelector(".page__charts"),I={currentDate:(O=new Date,j=O.getFullYear(),x=(O.getMonth()+1).toString().padStart(2,"0"),D=O.getDate().toString().padStart(2,"0"),"".concat(j,"-").concat(x,"-").concat(D)),getCurrentDate:function(){return this.currentDate},setCurrentDate:function(e){this.currentDate=e}},q=new f((function(){return I.getCurrentDate()}),(function(){T.fillSummary()}),M),T=new y({getCurrentElements:function(){return q.getCurrentElements()},getCurrentDate:function(){return I.getCurrentDate()}},M),A=new p(".page__chart-amount"),B=new p(".page__chart-percent");function M(){var e=JSON.parse(localStorage.getItem("meals"));if(k.classList.contains("navigation__link_active")){var t=function(e){var t=new Date;t.setDate(t.getDate()-6);for(var r=[],n=function(){var n=new Date(t);n.setDate(n.getDate()+a);var o=g(n),i=null==e?void 0:e.filter((function(e){return b(n,e.date)})),l=(null==i?void 0:i.reduce((function(e,t){return e+(t.mealEnergy||0)}),0))||0;r.push({date:o,value:l})},a=0;a<7;a++)n();return r}(e),r=function(e){var t=JSON.parse(localStorage.getItem("goals")),r=0;if((null==t?void 0:t.length)>0){var n=t.map((function(e){return e.goal}));r=Math.round(n.reduce((function(e,t){return e+t}))/n.length)}var a=[];return e.forEach((function(e){var n=null==t?void 0:t.find((function(t){return g(t.date)===e.date})),o=n?n.goal:r,i=Math.round(e.value/o*100),l=E(E({},e),{},{value:i});a.push(l)})),a}(t);A.renderChart(t),B.renderChart(r)}}q.setEventListeners(),T.setEventListeners(),C.addEventListener("change",(function(){var e,t=function(e){var t=new Date(e);return t.getDate()+" "+["января","февраля","марта","апреля","мая","июня","июля","августа","сентября","октября","ноября","декабря"][t.getMonth()]}(C.value);I.setCurrentDate(C.value),e=b(new Date,C.value)?"Сегодня":t,P.textContent=e,q.renderItems(),q.dropSearch(),T.fillSummary()})),k.addEventListener("click",(function(){k.classList.contains("navigation__link_active")?(L.classList.remove("page__charts_active"),k.classList.remove("navigation__link_active")):(L.classList.add("page__charts_active"),k.classList.add("navigation__link_active"),M(),window.scrollTo({top:document.body.scrollHeight,behavior:"smooth"}))}))})();